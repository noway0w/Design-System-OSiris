<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Live Tracking Map Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#13a4ec",
            "background-light": "#f6f7f8",
            "background-dark": "#101c22",
            "card-dark": "#1c262d",
            "text-secondary": "#9db0b9",
          },
          fontFamily: { "display": ["Plus Jakarta Sans", "sans-serif"] },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "2xl": "1rem", "full": "9999px" },
        },
      },
    }
  </script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.js"></script>
  <style>
    .map-marker-pulse { animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite; }
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 0.8; }
      50% { opacity: 0.4; }
      100% { transform: scale(2.4); opacity: 0; }
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display overflow-hidden h-screen flex flex-col antialiased selection:bg-primary selection:text-white">
  <div id="map-app-root" class="relative flex-1 min-h-0 overflow-hidden">
    <!-- Map Container (always full screen) -->
    <div class="absolute inset-0" style="background:#010b19">
      <div id="map-app-container" class="absolute inset-0 w-full h-full"></div>
      <div id="map-gradient-overlay" class="absolute inset-0 bg-gradient-to-t from-background-dark via-transparent to-background-dark/30 pointer-events-none transition-opacity duration-300"></div>

    </div>
    <!-- Top Bar Overlay -->
    <div class="absolute top-0 left-0 right-0 z-20 pt-12 px-6 pb-4 bg-gradient-to-b from-background-dark/90 to-transparent flex items-center gap-3 pointer-events-none">
      <div class="pointer-events-auto flex items-center gap-3">
        <a href="index.html" class="flex items-center justify-center w-10 h-10 bg-card-dark/80 backdrop-blur-md rounded-full border border-white/5 shadow-lg text-white hover:bg-card-dark transition-colors">
          <span class="material-symbols-outlined">menu</span>
        </a>
        <button id="gps-status-btn" class="flex items-center gap-2 bg-card-dark/80 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/5 shadow-lg">
          <span class="material-symbols-outlined text-green-400 text-[18px]">my_location</span>
          <span class="text-xs font-semibold tracking-wide text-white">Location Active</span>
        </button>
      </div>
    </div>
    <!-- Right Side Controls -->
    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col gap-3 z-20">
        <button id="map-zoom-in" class="w-12 h-12 bg-card-dark/90 backdrop-blur rounded-xl flex items-center justify-center text-white shadow-lg border border-white/5 active:scale-95 transition-transform">
          <span class="material-symbols-outlined">add</span>
        </button>
        <button id="map-zoom-out" class="w-12 h-12 bg-card-dark/90 backdrop-blur rounded-xl flex items-center justify-center text-white shadow-lg border border-white/5 active:scale-95 transition-transform">
          <span class="material-symbols-outlined">remove</span>
        </button>
        <button id="map-rotate" class="w-12 h-12 bg-card-dark/90 backdrop-blur rounded-xl flex items-center justify-center text-white shadow-lg border border-white/5 mt-2 active:scale-95 transition-transform" aria-pressed="false" title="Rotate globe">
          <span class="material-symbols-outlined">autorenew</span>
        </button>
        <button id="map-gps" class="w-12 h-12 bg-card-dark/90 backdrop-blur rounded-xl flex items-center justify-center text-primary shadow-lg border border-white/5 active:scale-95 transition-transform">
          <span class="material-symbols-outlined transform rotate-45">navigation</span>
        </button>
      </div>
    <!-- Bottom Sheet / Overlay Content (collapsible) -->
    <div id="bottom-sheet" class="absolute bottom-0 left-0 right-0 z-30 bg-background-dark border-t border-white/5 flex flex-col shadow-[0_-10px_40px_rgba(0,0,0,0.5)] transition-all duration-300 ease-out cursor-pointer">
      <button id="bottom-sheet-toggle" type="button" class="w-full flex justify-center items-center pt-5 pb-4 cursor-pointer hover:opacity-80 transition-opacity min-h-[40px]" aria-expanded="true">
        <div class="w-12 h-1 bg-white/10 rounded-full"></div>
      </button>
      <div id="bottom-sheet-content" class="overflow-hidden transition-all duration-300 ease-out">
      <div class="px-6 pb-4 flex items-center justify-between">
        <div>
          <h2 class="text-lg font-bold text-white">Nearby Friends</h2>
          <p class="text-sm text-text-secondary">6 friends worldwide</p>
        </div>
        <button class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-5 rounded-full shadow-[0_4px_20px_rgba(19,164,236,0.3)] flex items-center gap-2 active:scale-95 transition-transform">
          <span class="material-symbols-outlined fill-current">radio_button_checked</span>
          <span>Record</span>
        </button>
      </div>
      <div class="w-full overflow-x-auto no-scrollbar pb-6 pl-6">
        <div class="flex gap-4 pr-6 w-max">
          <div data-friend-card="Sarah J." class="w-48 bg-card-dark p-3 rounded-2xl border border-primary/30 flex flex-col gap-3 relative overflow-hidden group cursor-pointer hover:border-primary/50 transition-colors">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-green-500 rounded-full shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-primary p-0.5">
              <img alt="Sarah J." class="w-full h-full object-cover rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBG5IuiIYOXTdp9w8Vqvy75n_LNueDKuBEFzWHEYR4vSNtKmFljOZOYwulNtCGOug88kKgckeXLAbn9bEYo_BCTkxRd4FW-veTWSJmknwOCDw-aoUeYmVDY6fBmmw9TgbldUHC9sqgC58vI_jDVHNCM2ExvKeip3bD-Ff54JwgPjI0927i2MvXNNoijP9MAADijzTJH3SDAKttVxNt-k303UIeUbdqqOlPV432j-VzHpWa_pd9BO4PSBzhc_ySy1EqEsqmV6ByptYw"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">Sarah J.</h3>
              <div class="flex items-center gap-1 mt-1 text-primary text-sm font-medium">
                <span class="material-symbols-outlined text-[16px]">near_me</span>
                <span>0.5 mi</span>
              </div>
            </div>
          </div>
          <div data-friend-card="Mike T." class="w-48 bg-card-dark p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative overflow-hidden group hover:border-white/10 transition-colors cursor-pointer">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-yellow-500 rounded-full"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-transparent p-0.5 grayscale group-hover:grayscale-0 transition-all">
              <img alt="Mike T." class="w-full h-full object-cover rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAPy7qTrwvb0VVlIC4AUXxu9oKHw1tTdcEK0xLkt_rafxpY8Q5vToM_97fe11fu3YdtVcgOSaHDhvHENwLIUWdcYa1z6fN_7yDLNallyS8GQpbCVKvRhq2TeqH5giXjNxNtxi55QRNrh2opNAEO5jMw1G_Hlo84OPSE_QiTZrrEGU53N6DB-bHImedXVE6qD4A5DErmaCsw3JiPJUTA8qxImYIK2t0mc0eeHwEK_sVwuecL0CKE--Pq2JQhk1us0B4hdPoQI61dye4"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">Mike T.</h3>
              <div class="flex items-center gap-1 mt-1 text-text-secondary text-sm">
                <span class="material-symbols-outlined text-[16px]">location_on</span>
                <span>1.2 mi</span>
              </div>
            </div>
          </div>
          <div data-friend-card="Emily R." class="w-48 bg-card-dark p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative overflow-hidden group hover:border-white/10 transition-colors cursor-pointer">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-gray-500 rounded-full"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-transparent p-0.5 grayscale group-hover:grayscale-0 transition-all">
              <img alt="Emily R." class="w-full h-full object-cover rounded-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDaldXINzAN1Fx_a7e4Iy4567-I05RjeUkU8oVLpQMAbITvEaxY7zeyfpDOTvrsnSx5o55osuO_dXUOxBz_iF_GPJz7nfoxQi2cIS9fVp8Mpm5gCVS4dluRnAVk-Cp3fP3gNu-RelI-8m0A2aA_pvkXyosiDDuRw8dgo1BVIfGMuzkLjv8eejWl-KN5hUwL-QXrJagvHaqNcYChw-jgp209aYCH4HPaP9QSwLp0LdZuwobK2ZJslE2-yJ3h2P6jViZ8doL-7uN3ANo"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">Emily R.</h3>
              <div class="flex items-center gap-1 mt-1 text-text-secondary text-sm">
                <span class="material-symbols-outlined text-[16px]">location_on</span>
                <span>Geneva</span>
              </div>
            </div>
          </div>
          <div data-friend-card="Marie L." class="w-48 bg-card-dark p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative overflow-hidden group hover:border-white/10 transition-colors cursor-pointer">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-green-500 rounded-full shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-primary p-0.5">
              <img alt="Marie L." class="w-full h-full object-cover rounded-full" src="https://i.pravatar.cc/150?u=marie"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">Marie L.</h3>
              <div class="flex items-center gap-1 mt-1 text-primary text-sm font-medium">
                <span class="material-symbols-outlined text-[16px]">near_me</span>
                <span>Paris</span>
              </div>
            </div>
          </div>
          <div data-friend-card="James W." class="w-48 bg-card-dark p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative overflow-hidden group hover:border-white/10 transition-colors cursor-pointer">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-yellow-500 rounded-full"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-transparent p-0.5 grayscale group-hover:grayscale-0 transition-all">
              <img alt="James W." class="w-full h-full object-cover rounded-full" src="https://i.pravatar.cc/150?u=james"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">James W.</h3>
              <div class="flex items-center gap-1 mt-1 text-text-secondary text-sm">
                <span class="material-symbols-outlined text-[16px]">location_on</span>
                <span>Milford Sound</span>
              </div>
            </div>
          </div>
          <div data-friend-card="Kenji S." class="w-48 bg-card-dark p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative overflow-hidden group hover:border-white/10 transition-colors cursor-pointer">
            <div class="absolute top-0 right-0 p-3">
              <div class="w-2.5 h-2.5 bg-green-500 rounded-full shadow-[0_0_8px_rgba(34,197,94,0.6)]"></div>
            </div>
            <div class="w-14 h-14 rounded-full border-2 border-primary p-0.5">
              <img alt="Kenji S." class="w-full h-full object-cover rounded-full" src="https://i.pravatar.cc/150?u=kenji"/>
            </div>
            <div>
              <h3 class="text-white font-bold text-base leading-tight">Kenji S.</h3>
              <div class="flex items-center gap-1 mt-1 text-primary text-sm font-medium">
                <span class="material-symbols-outlined text-[16px]">near_me</span>
                <span>Tokyo</span>
              </div>
            </div>
          </div>
          <div class="w-48 bg-card-dark/50 p-3 rounded-2xl border border-white/5 flex flex-col gap-3 relative">
            <div class="w-14 h-14 rounded-full bg-white/5 animate-pulse"></div>
            <div class="flex flex-col gap-2">
              <div class="h-4 w-24 bg-white/5 rounded animate-pulse"></div>
              <div class="h-3 w-16 bg-white/5 rounded animate-pulse"></div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>

  <!-- Token Prompt Overlay (shown when no Mapbox token) -->
  <div id="map-token-overlay" class="hidden fixed inset-0 z-50 bg-background-dark/95 flex items-center justify-center p-6">
    <div class="bg-card-dark rounded-2xl p-8 max-w-md w-full border border-white/5">
      <h3 class="text-xl font-bold text-white mb-2">Mapbox Token Required</h3>
      <p class="text-text-secondary text-sm mb-6">Enter your Mapbox Access Token to view the map.</p>
      <input type="text" id="mapbox-token-app" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-white/40 mb-4" placeholder="Paste your Mapbox Access Token (pk....)">
      <button id="load-map-app" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 px-5 rounded-full">Load Map</button>
    </div>
  </div>

  <script src="js/mapbox-config.js"></script>
  <script src="js/location-service.js"></script>
  <script src="js/map-app.js"></script>
  <script>
    if (!sessionStorage.getItem('osiris_authenticated')) {
      window.location.href = 'access-gate.html';
    } else {
      document.addEventListener('DOMContentLoaded', () => {
      initMapApp();
      initBottomSheet();
    });
    }
  </script>
</body>
</html>
